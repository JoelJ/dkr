#!/bin/bash -e

if [ "${DKR_HOME}" == "" ]; then
	export DKR_HOME=~/.dkr
fi

function debug {
	if [ "${DKR_DEBUG}" != "" ]; then
		echo "$@" >&2
	fi
}

function err {
	echo "$@" >&2
}

function usage {
	err "Docker Wrapper"
	err ""
	err "In addition to standard docker commands, the following are available:"
	for option in $(declare -F | grep -Eo "dkr-.*"); do
		if [[ "${option}" != *-summary_ ]]; then
			set +e
			2>/dev/null 1>/dev/null type "${option}-summary_"
			exitCode=$?
			set -e

			if [ "${exitCode}" == "0" ]; then
				err "	${option:4} - $(eval ${option}-summary_)"
			else
				err "	${option:4}"
			fi
		fi
	done
}

for file in `ls ${DKR_HOME}/*`; do
	if [[ -x ${file} ]]; then
		debug "Sourcing ${file}"
		source ${file}
	else
		debug "Skipping ${file}. Not Executable."
	fi
done

if [ "$1" == "" ]; then
	usage
	exit 1
fi

set +e
2>/dev/null 1>/dev/null type "dkr-$1"
exitCode=$?
set -e

if [ "$exitCode" == "0" ]; then
	command="dkr-$1"
	shift
	eval ${command} "$@"
else
	docker "$@"
fi
